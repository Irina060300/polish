#include "header.h"

char **init_pole() {
    char **pole = (char **)malloc(sizeof(char *) * POLE_HEIGHT);
    for (int i = 0; i < POLE_HEIGHT; i++) {
        pole[i] = (char *)malloc(sizeof(char) * POLE_WIDTH);
    }
    return pole;
}

// FIXME: input > 10 !!!!!!!
// TODO: dynamic memory allocation!!!!!!!!

int main() {
    char data[NMAX];
    char new_data[NMAX];
    char polish[NMAX];
    char **pole = init_pole();
    t_signes stack;
    t_numbers stk;

    init_signes(&stack);

    while (1) {
        initscr();
        input(data);
        change_str(data, new_data);
        check_extra_symbols(new_data);
        if (check_data(new_data) == 0) {
            polish_get(&stack, new_data, polish);
            result(polish, &stk, pole);
            printw("\n  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            printw("  |                                                Click \"p\" to continue or click \"q\" to exit the visualizer                                                      |\n");
            printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            char c[2] = " ";
            while (!(c[0] == 'q' || c[0] == 'Q' ||c[0] == 'p' || c[0] == 'P')) {
                printw("  ");
                scanw("%[^\n]%*c", c);
                if ((c[0] == 'q' && c[1] == '\0') || (c[0] == 'Q' && c[1] == '\0'))
                    endwin();
                else {
                    if ((c[0] == 'p' && c[1] == '\0') || (c[0] == 'P' && c[1] == '\0'))
                        continue;
                }
                printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
                printw("  |                                                                     Wrong click                                                                               |\n");
                printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            }
            if (c[0] == 'q' && c[1] == '\0') break;
        } else {
            printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            printw("  |                                                             You made a mistake, try again                                                                     |\n");
            printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            printw("  |                                            Click \"p\" to continue or click \"q\" to exit the visualizer                                                          |\n");
            printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            char c[2] = " ";
            while (!(c[0] == 'q' || c[0] == 'Q' ||c[0] == 'p' || c[0] == 'P')) {
                printw("  ");
                scanw("%[^\n]%*c", c);
                if ((c[0] == 'q' && c[1] == '\0') || (c[0] == 'Q' && c[1] == '\0'))
                    endwin();
                else {
                    if ((c[0] == 'p' && c[1] == '\0') || (c[0] == 'P' && c[1] == '\0'))
                        continue;
                }
                printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
                printw("  |                                                                     Wrong click                                                                               |\n");
                printw("  -----------------------------------------------------------------------------------------------------------------------------------------------------------------\n");
            }
            if (c[0] == 'q' && c[1] == '\0') 
                endwin();
        }
        clear();
    }
    return 0;
}
